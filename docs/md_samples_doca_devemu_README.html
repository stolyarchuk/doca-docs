<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>NVIDIA DOCA SDK: PCI Device Samples</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<!-- Doxygen Awesome CSS -->
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
<script type="text/javascript" src="doxygen-awesome-paragraph-link.js"></script>
<script type="text/javascript">
DoxygenAwesomeDarkModeToggle.init()
DoxygenAwesomeFragmentCopyButton.init()
DoxygenAwesomeParagraphLink.init()
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectname">NVIDIA DOCA SDK
  </td>
  <td id="projectbrief">Data Center on a Chip Framework Documentation</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md_samples_doca_devemu_README.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">PCI Device Samples </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="autotoc_md65"></a>
PCI Device List</h1>
<p>This sample illustrates how to list all emulated devices that have the generic type configured in <code><a class="el" href="devemu__pci__type__config_8h.html">devemu_pci_type_config.h</a></code>.</p>
<h2><a class="anchor" id="autotoc_md66"></a>
Sample Logic</h2>
<ul>
<li>Initializing the generic PCIe type based on <code><a class="el" href="devemu__pci__type__config_8h.html">devemu_pci_type_config.h</a></code>.</li>
<li>Creating a list of all emulated devices belonging to this type.</li>
<li>Iterating over the emulated devices.</li>
<li>Dumping their VUID.</li>
<li>Dumping their PCIe address as seen by the host.</li>
<li>Releasing the resources.</li>
</ul>
<h2><a class="anchor" id="autotoc_md67"></a>
References</h2>
<ul>
<li><code>doca_devemu/</code><ul>
<li><code>devemu_pci_device_list/</code><ul>
<li><code><a class="el" href="devemu__pci__device__list__sample_8c.html">devemu_pci_device_list_sample.c</a></code></li>
<li><code><a class="el" href="devemu__pci__device__list__main_8c.html">devemu_pci_device_list_main.c</a></code></li>
<li><code>meson.build</code></li>
</ul>
</li>
</ul>
</li>
<li><code><a class="el" href="devemu__pci__common_8h.html">devemu_pci_common.h</a></code></li>
<li><code><a class="el" href="devemu__pci__common_8c.html">devemu_pci_common.c</a></code></li>
<li><code><a class="el" href="devemu__pci__type__config_8h.html">devemu_pci_type_config.h</a></code></li>
</ul>
<h1><a class="anchor" id="autotoc_md68"></a>
PCI Device Hot-Plug</h1>
<p>This sample illustrates how to create and hot-plug/hot-unplug an emulated device that has the generic type configured in <code><a class="el" href="devemu__pci__type__config_8h.html">devemu_pci_type_config.h</a></code>.</p>
<h2><a class="anchor" id="autotoc_md69"></a>
Sample Logic</h2>
<ul>
<li>Initializing the generic PCIe type based on <code><a class="el" href="devemu__pci__type__config_8h.html">doca_devemu/devemu_pci_type_config.h</a></code>.</li>
<li>Acquiring the emulated device representor:<ul>
<li>If the user did not provide VUID as input, then creating and using a new emulated device.</li>
<li>If the user provided VUID as an input, then searching for an existing emulated device with a matching VUID and using it.</li>
</ul>
</li>
<li>Creating a PCIe device context to manage the emulated device and connecting it to a progress engine (PE).</li>
<li>Registering to the PCIe device's hot-plug state change event.</li>
<li>Initializing hot-plug/hot-unplug of the device:<ul>
<li>If the user did not provide VUID as input, then initializing hot-plug flow of the device.</li>
<li>If the user provided VUID as input, then initializing hot-unplug flow of the device.</li>
</ul>
</li>
<li>Using the PE to poll for hot-plug state change event.</li>
<li>Waiting until hot-plug state transitions to expected state (power on or power off).</li>
<li>Cleaning up resources.<ul>
<li>If hot-unplug was requested, then the emulated device is destroyed as well.</li>
<li>Otherwise, the emulated device persists.</li>
</ul>
</li>
</ul>
<h2><a class="anchor" id="autotoc_md70"></a>
References</h2>
<ul>
<li><code>/doca_devemu/</code><ul>
<li><code>devemu_pci_device_hotplug/</code><ul>
<li><code><a class="el" href="devemu__pci__device__hotplug__sample_8c.html">devemu_pci_device_hotplug_sample.c</a></code></li>
<li><code><a class="el" href="devemu__pci__device__hotplug__main_8c.html">devemu_pci_device_hotplug_main.c</a></code></li>
<li><code>meson.build</code></li>
</ul>
</li>
</ul>
</li>
<li><code><a class="el" href="devemu__pci__common_8h.html">devemu_pci_common.h</a></code></li>
<li><code><a class="el" href="devemu__pci__common_8c.html">devemu_pci_common.c</a></code></li>
<li><code><a class="el" href="devemu__pci__type__config_8h.html">devemu_pci_type_config.h</a></code></li>
</ul>
<h1><a class="anchor" id="autotoc_md71"></a>
PCI Device Stateful Region</h1>
<p>This sample illustrates how the host driver can write to a stateful region, and how the BlueField Arm can handle the write operation.</p>
<h2><a class="anchor" id="autotoc_md72"></a>
Sample Logic</h2>
<h3><a class="anchor" id="autotoc_md73"></a>
BlueField Sample Logic</h3>
<ul>
<li>Initializing the generic PCIe type based on <code><a class="el" href="devemu__pci__type__config_8h.html">devemu_pci_type_config.h</a></code>.</li>
<li>Acquiring the emulated device representor that matches the provided VUID.</li>
<li>Creating a PCIe device context to manage the emulated device and connecting it to a progress engine (PE).</li>
<li>For each stateful region configured in <code><a class="el" href="devemu__pci__type__config_8h.html">devemu_pci_type_config.h</a></code>, registering to the PCIe device's stateful region write event.</li>
<li>Using the PE to poll for driver write to any of the stateful regions.</li>
<li>Every time the host driver writes to the stateful region, the handler is invoked and performs the following:<ul>
<li>Queries the values of the stateful region that the host wrote to.</li>
<li>Logs the values of the stateful region.</li>
</ul>
</li>
<li>The sample polls indefinitely until the user presses <code>[Ctrl+c]</code> to close the sample.</li>
<li>Cleaning up resources.</li>
</ul>
<h3><a class="anchor" id="autotoc_md74"></a>
Host Sample Logic</h3>
<ul>
<li>Initializing the VFIO device with a matching PCIe address and VFIO group.</li>
<li>Mapping the stateful memory region from the BAR to the process address space.</li>
<li>Writing the values provided as input to the beginning of the stateful region.</li>
</ul>
<h2><a class="anchor" id="autotoc_md75"></a>
References</h2>
<ul>
<li><code>doca_devemu/</code><ul>
<li><code>devemu_pci_device_stateful_region/dpu/</code></li>
<li><code><a class="el" href="devemu__pci__device__stateful__region__dpu__sample_8c.html">devemu_pci_device_stateful_region_dpu_sample.c</a></code></li>
<li><code><a class="el" href="devemu__pci__device__stateful__region__dpu__main_8c.html">devemu_pci_device_stateful_region_dpu_main.c</a></code></li>
<li><code>meson.build</code></li>
</ul>
</li>
<li><code>devemu_pci_device_stateful_region/host/</code><ul>
<li><code><a class="el" href="devemu__pci__device__stateful__region__host__sample_8c.html">devemu_pci_device_stateful_region_host_sample.c</a></code></li>
<li><code><a class="el" href="devemu__pci__device__stateful__region__host__main_8c.html">devemu_pci_device_stateful_region_host_main.c</a></code></li>
<li><code>meson.build</code></li>
</ul>
</li>
<li><code><a class="el" href="devemu__pci__common_8h.html">devemu_pci_common.h</a></code></li>
<li><code><a class="el" href="devemu__pci__common_8c.html">devemu_pci_common.c</a></code></li>
<li><code><a class="el" href="devemu__pci__host__common_8h.html">devemu_pci_host_common.h</a></code></li>
<li><code><a class="el" href="devemu__pci__host__common_8c.html">devemu_pci_host_common.c</a></code></li>
<li><code><a class="el" href="devemu__pci__type__config_8h.html">devemu_pci_type_config.h</a></code></li>
</ul>
<h1><a class="anchor" id="autotoc_md76"></a>
PCI Device DB</h1>
<p>This sample illustrates how the host driver can ring the doorbell and how the BlueField can retrieve the doorbell value. The sample also demonstrates how to handle FLR.</p>
<h2><a class="anchor" id="autotoc_md77"></a>
Sample Logic</h2>
<h3><a class="anchor" id="autotoc_md78"></a>
BlueField Sample Logic</h3>
<h4><a class="anchor" id="autotoc_md79"></a>
Host (BlueField Arm) Logic</h4>
<ul>
<li>Initializing the generic PCIe type based on <code><a class="el" href="devemu__pci__type__config_8h.html">devemu_pci_type_config.h</a></code>.</li>
<li>Initializing DPA resources:<ul>
<li>Creating DPA instance and associating it with the DPA application.</li>
<li>Creating DPA thread and associating it with the DPA DB handler.</li>
<li>Creating DB completion context and associating it with the DPA thread.</li>
</ul>
</li>
<li>Acquiring the emulated device representor that matches the provided VUID.</li>
<li>Creating a PCIe device context to manage the emulated device and connecting it to progress engine (PE).</li>
<li>Registering to the context state changes event.</li>
<li>Registering to the PCIe device FLR event.</li>
<li>Using the PE to poll for any of the following:<ul>
<li>Every time the PCIe device context state transitions to running, the handler performs the following:<ul>
<li>Creates a DB object.</li>
<li>Makes RPC to DPA, to initialize the DB object.</li>
</ul>
</li>
<li>Every time the PCIe device context state transitions to stopping, the handler performs the following:<ul>
<li>Makes RPC to DPA, to un-initialize the DB object.</li>
<li>Destroys the DB object.</li>
</ul>
</li>
<li>Every time the host driver initializes or destroys the VFIO device, an FLR event is triggered. The FLR handler performs the following:<ul>
<li>Destroys DB object.</li>
<li>Stops the PCIe device context.</li>
<li>Starts the PCIe device context again.</li>
</ul>
</li>
</ul>
</li>
<li>The sample polls indefinitely until the user presses <code>[Ctrl+c]</code> to close the sample.</li>
</ul>
<h4><a class="anchor" id="autotoc_md80"></a>
Device (BlueField DPA) Logic</h4>
<ul>
<li>Initializing application RPC:<ul>
<li>Setting the global context to point to the DB completion context DPA handle.</li>
<li>Binding DB to the doorbell completion context.</li>
</ul>
</li>
<li>Un-initializing application RPC:<ul>
<li>Unbinding DB from the doorbell completion context.</li>
</ul>
</li>
<li>DB handler:<ul>
<li>Getting DB completion element from completion context.</li>
<li>Getting DB handle from the DB completion element.</li>
<li>Acknowledging the DB completion element.</li>
<li>Requesting notification from DB completion context.</li>
<li>Requesting notification from DB.</li>
<li>Getting DB value from DB.</li>
</ul>
</li>
</ul>
<h3><a class="anchor" id="autotoc_md81"></a>
The host sample logic includes</h3>
<ul>
<li>Initializing the VFIO device with its matching PCIe address and VFIO group.</li>
<li>Mapping the DB memory region from the BAR to the process address space.</li>
<li>Writing the value provided as input to the DB region at the given offset.</li>
</ul>
<h2><a class="anchor" id="autotoc_md82"></a>
References</h2>
<ul>
<li><code>doca_devemu/</code><ul>
<li><code>devemu_pci_device_db/dpu/</code><ul>
<li><code>host/</code><ul>
<li><code><a class="el" href="devemu__pci__device__db__dpu__sample_8c.html">devemu_pci_device_db_dpu_sample.c</a></code></li>
</ul>
</li>
</ul>
</li>
<li><code>device/</code><ul>
<li><code><a class="el" href="devemu__pci__device__db__dpu__kernels__dev_8c.html">devemu_pci_device_db_dpu_kernels_dev.c</a></code></li>
</ul>
</li>
<li><code><a class="el" href="devemu__pci__device__db__dpu__main_8c.html">devemu_pci_device_db_dpu_main.c</a></code></li>
<li><code>meson.build</code></li>
<li><code>devemu_pci_device_db/host/</code><ul>
<li><code><a class="el" href="devemu__pci__device__db__host__sample_8c.html">devemu_pci_device_db_host_sample.c</a></code></li>
<li><code><a class="el" href="devemu__pci__device__db__host__main_8c.html">devemu_pci_device_db_host_main.c</a></code></li>
<li><code>meson.build</code></li>
</ul>
</li>
<li><code><a class="el" href="devemu__pci__common_8h.html">devemu_pci_common.h</a></code></li>
<li><code><a class="el" href="devemu__pci__common_8c.html">devemu_pci_common.c</a></code></li>
<li><code><a class="el" href="devemu__pci__host__common_8h.html">devemu_pci_host_common.h</a></code></li>
<li><code><a class="el" href="devemu__pci__host__common_8c.html">devemu_pci_host_common.c</a></code></li>
<li><code><a class="el" href="devemu__pci__type__config_8h.html">devemu_pci_type_config.h</a></code></li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="autotoc_md83"></a>
PCI Device MSI-X</h1>
<p>This sample illustrates how BlueField can raise an MSI-X vector, sending a signal towards the host, and shows how the host can retrieve this signal.</p>
<h2><a class="anchor" id="autotoc_md84"></a>
Sample Logic</h2>
<h3><a class="anchor" id="autotoc_md85"></a>
BlueField Sample Logic</h3>
<h4><a class="anchor" id="autotoc_md86"></a>
Host (BlueField Arm) Logic</h4>
<ul>
<li>Initializing the generic PCIe type based on <code><a class="el" href="devemu__pci__type__config_8h.html">devemu_pci_type_config.h</a></code>.</li>
<li>Initializing DPA resources:<ul>
<li>Creating a DPA instance and associating it with the DPA application.</li>
<li>Creating a DPA thread and associating it with the DPA DB handler.</li>
</ul>
</li>
<li>Acquiring the emulated device representor that matches the provided VUID.</li>
<li>Creating a PCIe device context to manage the emulated device and connecting it to a progress engine (PE).</li>
<li>Creating an MSI-X vector and acquiring its DPA handle.</li>
<li>Sending an RPC to the DPA to raise the MSI-X vector.</li>
<li>Cleaning up resources.</li>
</ul>
<h4><a class="anchor" id="autotoc_md87"></a>
Device (BlueField DPA) Logic</h4>
<ul>
<li>Raising the MSI-X RPC by using the MSI-X vector handle.</li>
</ul>
<h3><a class="anchor" id="autotoc_md88"></a>
Host Sample Logic</h3>
<ul>
<li>Initializing the VFIO device with the matching PCIe address and VFIO group.</li>
<li>Mapping each MSI-X vector to a different FD.</li>
<li>Reading events from the FDs in a loop.</li>
<li>Once the DPU raises MSI-X, the FD matching the MSI-X vector returns an event which is then printed to the screen.</li>
<li>The sample polls the FDs indefinitely until the user presses <code>[Ctrl+c]</code> to close the sample.</li>
</ul>
<h2><a class="anchor" id="autotoc_md89"></a>
References</h2>
<ul>
<li><code>doca_devemu/</code><ul>
<li><code>devemu_pci_device_msix/dpu/</code><ul>
<li><code>host/</code><ul>
<li><code><a class="el" href="devemu__pci__device__msix__dpu__sample_8c.html">devemu_pci_device_msix_dpu_sample.c</a></code></li>
</ul>
</li>
<li><code>device/</code><ul>
<li><code><a class="el" href="devemu__pci__device__msix__dpu__kernels__dev_8c.html">devemu_pci_device_msix_dpu_kernels_dev.c</a></code></li>
</ul>
</li>
<li><code><a class="el" href="devemu__pci__device__msix__dpu__main_8c.html">devemu_pci_device_msix_dpu_main.c</a></code></li>
<li><code>meson.build</code></li>
</ul>
</li>
<li><code>devemu_pci_device_msix/host/</code><ul>
<li><code><a class="el" href="devemu__pci__device__msix__host__sample_8c.html">devemu_pci_device_msix_host_sample.c</a></code></li>
<li><code><a class="el" href="devemu__pci__device__msix__host__main_8c.html">devemu_pci_device_msix_host_main.c</a></code></li>
<li><code>meson.build</code></li>
</ul>
</li>
<li><code><a class="el" href="devemu__pci__common_8h.html">devemu_pci_common.h</a></code></li>
<li><code><a class="el" href="devemu__pci__common_8c.html">devemu_pci_common.c</a></code></li>
<li><code><a class="el" href="devemu__pci__host__common_8h.html">devemu_pci_host_common.h</a></code></li>
<li><code><a class="el" href="devemu__pci__host__common_8c.html">devemu_pci_host_common.c</a></code></li>
<li><code><a class="el" href="devemu__pci__type__config_8h.html">devemu_pci_type_config.h</a></code></li>
</ul>
</li>
</ul>
<h1><a class="anchor" id="autotoc_md90"></a>
PCI Device DMA</h1>
<p>This sample illustrates how the host driver can set up memory for DMA, then the DPU can use that memory to copy a string from the BlueField to the host and from the host to the BlueField.</p>
<h2><a class="anchor" id="autotoc_md91"></a>
Sample Logic</h2>
<h3><a class="anchor" id="autotoc_md92"></a>
BlueField Sample Logic</h3>
<ul>
<li>Initializing the generic PCIe type based on <code><a class="el" href="devemu__pci__type__config_8h.html">devemu_pci_type_config.h</a></code>.</li>
<li>Acquiring the emulated device representor that matches the provided VUID.</li>
<li>Creating a PCIe device context to manage the emulated device and connecting it to a progress engine (PE).</li>
<li>Creating a DMA context to use for copying memory across the host and BlueField.</li>
<li>Setting up an mmap representing the host driver memory buffer.</li>
<li>Setting up an mmap representing a local memory buffer.</li>
<li>Use the DMA context to copy memory from host to BlueField.</li>
<li>Use the DMA context to copy memory from BlueField to host.</li>
<li>Cleaning up resources.</li>
</ul>
<h3><a class="anchor" id="autotoc_md93"></a>
Host Sample Logic</h3>
<ul>
<li>Initializing the VFIO device with the matching PCIe address and VFIO group.</li>
<li>Allocating memory buffer.</li>
<li>Mapping the memory buffer to I/O memory. The BlueField can now access the memory using the I/O address through DMA.</li>
<li>Copying the string provided by user to the memory buffer.</li>
<li>Waiting for the BlueField to write to the memory buffer.</li>
<li>Un-mapping the memory buffer.</li>
<li>Cleaning up resources.</li>
</ul>
<h2><a class="anchor" id="autotoc_md94"></a>
References</h2>
<ul>
<li><code>doca_devemu/</code><ul>
<li><code>devemu_pci_device_dma/dpu/</code><ul>
<li><code><a class="el" href="devemu__pci__device__dma__dpu__sample_8c.html">devemu_pci_device_dma_dpu_sample.c</a></code></li>
<li><code><a class="el" href="devemu__pci__device__dma__dpu__main_8c.html">devemu_pci_device_dma_dpu_main.c</a></code></li>
<li><code>meson.build</code></li>
</ul>
</li>
<li><code>devemu_pci_device_dma/host/</code><ul>
<li><code><a class="el" href="devemu__pci__device__dma__host__sample_8c.html">devemu_pci_device_dma_host_sample.c</a></code></li>
<li><code><a class="el" href="devemu__pci__device__dma__host__main_8c.html">devemu_pci_device_dma_host_main.c</a></code></li>
<li><code>meson.build</code> </li>
</ul>
</li>
</ul>
</li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Wed Aug 13 2025 09:23:37 for NVIDIA DOCA SDK by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
